<html>
<head>
  <style>
    body {
      margin: 2em;
      padding: 0;
      text-align: center; /* !!! */
    };
    #center-main {
      width:800px; margin:0 auto;
    }
    #comments {
      text-align: left;
    }
    #comments > div {
      margin-top: 1em;
      border: #cccc 1px solid;
      padding: 0.5em;
    }
  </style>
  <script type="text/javascript" src="dist/Hyperdata.js"></script>
</head>

<body>
  <blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">âœ¨A new year and a renewed purpose. A new website and a growing team. And a new blog post to explain it all.âœ¨  <br><br>ðŸ™Œ Thank you for being part of this adventure! ðŸ™Œ  <a href="https://twitter.com/hashtag/AKASHA?src=hash&amp;ref_src=twsrc%5Etfw">#AKASHA</a> <a href="https://twitter.com/hashtag/FTW?src=hash&amp;ref_src=twsrc%5Etfw">#FTW</a> #2019 <a href="https://twitter.com/hashtag/Metamorphosis?src=hash&amp;ref_src=twsrc%5Etfw">#Metamorphosis</a><a href="https://t.co/uzEqeeIEdR">https://t.co/uzEqeeIEdR</a> <a href="https://t.co/lZlcg3I1CP">pic.twitter.com/lZlcg3I1CP</a></p>&mdash; AKASHA (@AkashaProject) <a href="https://twitter.com/AkashaProject/status/1085598391827120130?ref_src=twsrc%5Etfw">January 16, 2019</a></blockquote>
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    

  <div id="center-main">
    <div id="comments"></div>
  </div>
  <script type="text/javascript">
    let comments = []

    const listItem = function (data) {
      // DID resolver
      // https://github.com/decentralized-identity/universal-resolver/blob/master/docs/api-definition.md
      // https://uniresolver.io/1.0/identifiers/did:sov:WRfXPg8dantKVubE3HX8pw

      if (!data || !data.comment) {
        return
      }
      // add a spacer
      document.getElementById('comments').appendChild(document.createElement('br'))

      const comment = document.createElement('div')
      comment.id = data.source
      comment.innerHTML = `<h3>${data.comment.body}</h3>`
      comment.innerHTML += `<p><small>Written on ${data.created}</small><br><small>Source: ${data.source}</small><br>`
      comment.innerHTML += `<pre>${JSON.stringify(data.comment)}</pre></p>`
      // find if we are replying to an existing comment
      const parent = document.getElementById(data.comment.ref)
      if (parent && data.comment.type === 'Reply') {
        console.log('Found parent!', data.ref)
        comment.setAttribute('style', 'margin-left: 1em;')
        parent.appendChild(comment)
      } else {
        console.log('Not a reply')
        document.getElementById('comments').appendChild(comment)  
      }
    }
    
    const toCommentsList = function (data) {
      comments.push(data)
      comments.sort(function(a,b){
        return new Date(a.created) - new Date(b.created)
      })
      // clear list
      document.getElementById('comments').innerHTML = ''

      comments.forEach(function (comment) {
        listItem(comment)
      })
    }

    // Init Hyperdata
    const conf = {
      config: {
        Addresses: {
          Swarm: [
            '/ip4/127.0.0.1/tcp/4001'
          ]
        }
      }
    }

    Hyperdata.IPFS.init(conf).then(function() {
      // Test Web fetching
      const urls = [
        'https://deiu.github.io/cdn/comment-ab019f3.jsonld',
        'ipfs://QmbsFk8RfvHhMnzQmLWqvYbCSdZeNhXJe7fYve2bSamtZv',  // Test IPFS fetching
        'ipfs://QmPPJ8bj3cq7ubChBMgZn5fbq2XmWWLiyBmuMggHS6WFgn'
      ]
      const webUrl = 'https://deiu.github.io/cdn/comment-ab019f3.jsonld'
      urls.forEach(function(url) {
        Hyperdata.Fetch(url).then(function(data) {
          if (data) {
            data.source = url
            toCommentsList(data)
          }
        }).catch(function(err) {
          console.log('ERROR fetching:', err)
        })
      })
    })
    
  </script>
</body>
</html>